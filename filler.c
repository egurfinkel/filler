/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   filler.c                                           :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: egurfink <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2017/04/15 17:23:42 by egurfink          #+#    #+#             */
/*   Updated: 2017/05/09 17:26:54 by egurfink         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include <stdio.h>
#include "includes/libft.h"
#include "includes/get_next_line.h"
#include "includes/ft_printf.h"

// find_piece_cords()   - find all possible variants of the token
// check_bounds()       - check whether the figure does not cross borders of the map
// Check_place()        - check whether the figure fits in a map, no overlap with enemy, 1 overlap with your territory

#define FD 0

typedef struct		s_s
{
	char			player;
	char			enemy;
	int				touch;
	char			**map;
	int				map_x;
	int				map_y;
	int 			map_cord_x;
	int 			map_cord_y;
	char 			**piece;
	int 			piece_cord_x;
	int 			piece_cord_y;
	int 			piece_x;
	int 			piece_y;
	int 			find;
	int 			i;
	int 			j;
	int 			brk;
	int 			x;
	int 			y;
    char            *line;
}					t_t;

void                first_init(t_t *s)
{
	s->player = 'X';
	s->enemy = 'O';
	s->touch = 0;
	s->map = NULL;
	s->map_x = 0;
	s->map_y = 0;
	s->map_cord_x = 0;
	s->map_cord_y = 0;
	s->piece = NULL;
	s->piece_cord_x = 0;
	s->piece_cord_y = 0;
	s->piece_x = -1;
	s->piece_y = -1;
	s->find = 1;
	s->i = -1;
	s->j = -1;
	s->brk = 0;
	s->x = 0;
	s->y = 0;
    s->line = (char *)malloc(sizeof(char) * 10000);
}

void		find_star(t_t *s)
{
	int 	i;
	int 	j;

    i = 0;
    while (i < s->piece_cord_x)
    {
        j = 0;
        while (j < s->piece_cord_y)
        {
            if (s->piece[i][j] == '*')
            {
                s->piece_x = i;
                s->piece_y = j;
                break ;
            }
            j++;
        }
        i++;
    }
}

void        fill_player(t_t *s)
{
    get_next_line(FD, &s->line);
    if (s->line[10] == '1')
    {
        s->player = 'O';
        s->enemy = 'X';
    }
}

void        fill_map(t_t *s)
{
    int i;
    get_next_line(FD, &s->line);
    i = 0;
    while (!ft_isdigit(s->line[i]))
        i++;
    s->map_x = 0;
    while (ft_isdigit(s->line[i]))
    {
        s->map_x += s->line[i] - '0';
        s->map_x *= 10;
        i++;
    }
    s->map_x /= 10;
    i++;
    while (ft_isdigit(s->line[i]))
    {
        s->map_y += s->line[i] - '0';
        s->map_y *= 10;
        i++;
    }
    s->map_y /= 10;
    s->map = (char **)malloc(sizeof(char *) * (s->map_x + 1));
    s->map[s->map_x] = NULL;
    i = 0;
    while (i < s->map_x)
    {
        s->map[i] = ft_strnew((size_t)(s->map_y + 1));
        i++;
    }
    get_next_line(FD, &s->line);
    i = 0;
    int l;
    int p;
    while (i < s->map_x)
    {
        get_next_line(FD, &s->line);
        l = 0;
        p = 4;
        while (s->line[p])
        {
            s->map[i][l] = s->line[p];
            l++;
            p++;
        }
        i++;
    }
}

void        fill_piece(t_t *s)
{
    int     i;
    int     l;

    get_next_line(FD, &s->line);
    i = 0;
    while (s->line[i] && !ft_isdigit(s->line[i]))
        i++;
    while (s->line[i] && ft_isdigit(s->line[i]))
    {
        s->piece_cord_x += s->line[i] - '0';
        s->piece_cord_x *= 10;
        i++;
    }
    s->piece_cord_x /= 10;
    i++;
    while (s->line[i] && ft_isdigit(s->line[i]))
    {
        s->piece_cord_y += s->line[i] - '0';
        s->piece_cord_y *= 10;
        i++;
    }
    s->piece_cord_y /= 10;
    i = 0;
    s->piece = (char **)malloc(sizeof(char *) * (s->piece_cord_x + 1));
    s->piece[s->piece_cord_x] = NULL;
    while (i < s->piece_cord_x)
    {
        l = 0;
        s->piece[i] = ft_strnew((size_t) (s->piece_cord_y + 1));
        get_next_line(FD, &s->line);
        while (s->line[l])
        {
            s->piece[i][l] = s->line[l];
            l++;
        }
        i++;
    }
}

void        find_coords_of_me(t_t *s)
{
    int     i;
    int     j;

    i = 0;
    while (i < s->map_x)
    {
        j = 0;
        while (j < s->map_y)
        {
            if (s->map[i][j] == s->player)
            {
                s->x = i;
                s->y = j;
                find_star(s);
                ft_printf("%d %d", s->x - s->piece_x, s->y - s->piece_y);
            }
            j++;
        }
        i++;
    }
    s->brk = 1;
}

//void 		find_coords(t_t *foo)
//{
//	int		i;
//	int 	j;
//
//	i = -1;
//	while (++i < (foo->map_x - foo->piece_x) && i < foo->piece_x)
//	{
//		j = -1;
//		while (++j < (foo->map_y - foo->piece_y) && j < foo->piece_y)
//		{
//
//		}
//	}
//	foo->i = -1;
//	while (++foo->i < foo->piece_cord_x && foo->touch < 2)
//	{
//		foo->j = -1;
//		while (++foo->j < foo->piece_cord_y && foo->touch < 2)
//		{
//			if (foo->piece[foo->i][foo->j] == '*' &&
//					(foo->map[foo->i][foo->j] == 'x' ||
//							foo->map[foo->i][foo->j] == 'X'))
//				foo->touch++;
//			else if (foo->touch < 0)
//				foo->brk++;
//		}
//	}
//}

int			main()
{
	t_t *s;
	int i = 0;

	s = (t_t*)malloc(sizeof(t_t));
	first_init(s);
    while (!s->brk)
    {
        fill_player(s);
        fill_map(s);
        fill_piece(s);
        find_coords_of_me(s);
    }
//	ft_printf("\n%c %c\n", s->player, s->enemy);
//	ft_printf("%d %d\n", s->map_y, s->map_x);
//	ft_printf("%d %d\n", s->piece_cord_y, s->piece_cord_x);
//	ft_printf("%c\n", s->piece[0][0]);
	return (0);
}
/*

 ===
$$$ exec p1 : [./a.out]
Plateau 15 17:
    01234567890123456
000 .................
001 .................
002 .................
003 .................
004 .................
005 .................
006 .................
007 .................
008 ..OO.............
009 .................
010 .................
011 .................
012 .............xx..
013 .................
014 .................
Piece 1 3:
.**

$$$ exec p2 : [./a.out]
Plateau 100 99:
    012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678
000 ...................................................................................................
001 ...................................................................................................
002 ...................................................................................................
003 ...................................................................................................
004 ...................................................................................................
005 ...................................................................................................
006 ...................................................................................................
007 ...................................................................................................
008 ...................................................................................................
009 ...................................................................................................
010 ...................................................................................................
011 ...................................................................................................
012 ...................................................................................................
013 ...................................................................................................
014 ...................................................................................................
015 ...................................................................................................
016 ...................................................................................................
017 ...................................................................................................
018 ...................................................................................................
019 ...................................................................................................
020 ...................................................................................................
021 ...................................................................................................
022 ...................................................................................................
023 ...................................................................................................
024 ...................................................................................................
025 ...................................................................................................
026 ...................................................................................................
027 ...................................................................................................
028 ...................................................................................................
029 ..............................X....................................................................
030 ...................................................................................................
031 ...................................................................................................
032 ...................................................................................................
033 ...................................................................................................
034 ...................................................................................................
035 ...................................................................................................
036 ...................................................................................................
037 ...................................................................................................
038 ...................................................................................................
039 ...................................................................................................
040 ...................................................................................................
041 ...................................................................................................
042 ...................................................................................................
043 ...................................................................................................
044 ...................................................................................................
045 ...................................................................................................
046 ...................................................................................................
047 ...................................................................................................
048 ...................................................................................................
049 ...................................................................................................
050 ...................................................................................................
051 ...................................................................................................
052 ...................................................................................................
053 ...................................................................................................
054 ...................................................................................................
055 ...................................................................................................
056 ...................................................................................................
057 ...................................................................................................
058 ...................................................................................................
059 ...................................................................................................
060 ...................................................................................................
061 ...................................................................................................
062 ...................................................................................................
063 ...................................................................................................
064 ...................................................................................................
065 ...................................................................................................
066 ...................................................................................................
067 ......................................................................o............................
068 .....................................................................oo............................
069 ......................................................................o............................
070 ...................................................................................................
071 ...................................................................................................
072 ...................................................................................................
073 ...................................................................................................
074 ...................................................................................................
075 ...................................................................................................
076 ...................................................................................................
077 ...................................................................................................
078 ...................................................................................................
079 ...................................................................................................
080 ...................................................................................................
081 ...................................................................................................
082 ...................................................................................................
083 ...................................................................................................
084 ...................................................................................................
085 ...................................................................................................
086 ...................................................................................................
087 ...................................................................................................
088 ...................................................................................................
089 ...................................................................................................
090 ...................................................................................................
091 ...................................................................................................
092 ...................................................................................................
093 ...................................................................................................
094 ...................................................................................................
095 ...................................................................................................
096 ...................................................................................................
097 ...................................................................................................
098 ...................................................................................................
099 ...................................................................................................
Piece 19 1:
.
.
.
.
.
.
.
.
.
.
.
*
*
*
.
.
.
.
.

$$$ exec p2 : [./a.out]
Plateau 100 99:
    012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678
000 ...................................................................................................
001 ...................................................................................................
002 ...................................................................................................
003 ...................................................................................................
004 ...................................................................................................
005 ...................................................................................................
006 ...................................................................................................
007 ...................................................................................................
008 ...................................................................................................
009 ...................................................................................................
010 ...................................................................................................
011 ...................................................................................................
012 ...................................................................................................
013 ...................................................................................................
014 ...................................................................................................
015 ...................................................................................................
016 ...................................................................................................
017 ...................................................................................................
018 ...................................................................................................
019 ...................................................................................................
020 ...................................................................................................
021 ...................................................................................................
022 ...................................................................................................
023 ...................................................................................................
024 ...................................................................................................
025 ...................................................................................................
026 ...................................................................................................
027 ...................................................................................................
028 ...................................................................................................
029 ..............................X....................................................................
030 ...................................................................................................
031 ...................................................................................................
032 ...................................................................................................
033 ...................................................................................................
034 ...................................................................................................
035 ...................................................................................................
036 ...................................................................................................
037 ...................................................................................................
038 ...................................................................................................
039 ...................................................................................................
040 ...................................................................................................
041 ...................................................................................................
042 ...................................................................................................
043 ...................................................................................................
044 ...................................................................................................
045 ...................................................................................................
046 ...................................................................................................
047 ...................................................................................................
048 ...................................................................................................
049 ...................................................................................................
050 ...................................................................................................
051 ...................................................................................................
052 ...................................................................................................
053 ...................................................................................................
054 ...................................................................................................
055 ...................................................................................................
056 ...................................................................................................
057 ...................................................................................................
058 ...................................................................................................
059 ...................................................................................................
060 ...................................................................................................
061 ...................................................................................................
062 ...................................................................................................
063 ...................................................................................................
064 ...................................................................................................
065 ...................................................................................................
066 ...................................................................................................
067 ...................................................................................................
068 ....................................................................oo.............................
069 .....................................................................oo............................
070 ...................................................................................................
071 ...................................................................................................
072 ...................................................................................................
073 ...................................................................................................
074 ...................................................................................................
075 ...................................................................................................
076 ...................................................................................................
077 ...................................................................................................
078 ...................................................................................................
079 ...................................................................................................
080 ...................................................................................................
081 ...................................................................................................
082 ...................................................................................................
083 ...................................................................................................
084 ...................................................................................................
085 ...................................................................................................
086 ...................................................................................................
087 ...................................................................................................
088 ...................................................................................................
089 ...................................................................................................
090 ...................................................................................................
091 ...................................................................................................
092 ...................................................................................................
093 ...................................................................................................
094 ...................................................................................................
095 ...................................................................................................
096 ...................................................................................................
097 ...................................................................................................
098 ...................................................................................................
099 ...................................................................................................
Piece 1 4:
..**

$$$ exec p2 : [./a.out]
Plateau 24 40:
    0123456789012345678901234567890123456789
000 ........................................
001 ........................................
002 ........................................
003 ...o....................................
004 ...o....................................
005 ...o....................................
006 ........................................
007 ........................................
008 ........................................
009 ........................................
010 ........................................
011 ........................................
012 ........................................
013 ........................................
014 ........................................
015 ........................................
016 ........................................
017 ........................................
018 ........................................
019 ................................X.......
020 ........................................
021 ........................................
022 ........................................
023 ........................................
Piece 4 4:
....
...*
.*.*
.***

$$$ exec p2 : [./a.out]
Plateau 24 40:
    0123456789012345678901234567890123456789
000 ........................................
001 ........................................
002 ........................................
003 ...o....................................
004 ...o....................................
005 ...o....................................
006 ........................................
007 ........................................
008 ........................................
009 ........................................
010 ........................................
011 ........................................
012 ........................................
013 ........................................
014 ........................................
015 ........................................
016 ........................................
017 ........................................
018 ........................................
019 ................................X.......
020 ........................................
021 ........................................
022 ........................................
023 ........................................
Piece 4 4:
....
...*
.*.*
.***

 */